# ðŸ¤– Gemini Context: nc-local-thumbnailer

## Project Overview
This is a Nextcloud application designed to solve the "No FFmpeg" problem on restricted hosts.
**Version**: 1.0.1
**Repos**: https://github.com/hersche/nc-local-thumbnailer/ | https://github.com/hersche/local-nc-local-thumbnailer/

## Technical Architecture
- **Namespace**: `OCA\Localthumbs`
- **Minimum NC Version**: 25
- **Primary Interface**: `OCP\Preview\IProviderV2`

## Key Components
1. **ThumbnailController**: 
   - `POST /thumbnail/upload`: Receives `.jpg` thumbnails and maps them to Nextcloud File IDs. (Supports streaming & sharding)
   - `GET /thumbnail/exists`: Checks if a thumbnail already exists for a given path.
   - `POST /thumbnail/batchExists`: Bulk check for multiple paths (v1.0.1+).
2. **PreviewProvider**:
   - Registered for `/^video\/.*/`.
   - Supports sharded lookups with legacy fallback.
3. **Storage**: 
   - Uses `IAppData` under `localthumbs/thumbs/{shard1}/{shard2}/{fileId}.jpg`.
   - Sharding: `shard1 = id % 100`, `shard2 = floor(id / 100) % 100`.

## Implementation Details for Gemini
- **Security**: Optional `X-Localthumbs-Secret` header check.
- **Registration**: Done via `IRegistrationContext::registerPreviewProvider` in `Application::register`.
- **Compatibility**: Supports NC 25-32. Handles `FileInfo` vs `File` transitions.
